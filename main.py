import glob
import json
import os.path

from bson import json_util

from consumer import Consumer
from process_999 import Process_999
from connectMongoDB import ConnectMongoDB
from consumer_277ca import Consumer277CA
from data_provider.data_provider_276 import DataProvider276
from data_provider.data_provider_277 import DataProvider277

if __name__ == '__main__':
    # data_provider_277_obj = DataProvider277()

    # edi_276 = {
    #     "header_section": {
    #         "file_name": "7f2ca44c-2910-4306-97c1-1438f5c56d2a.276",
    #         "date_created": {
    #             "date": "18:57:15",
    #             "time": "20210816"
    #         },
    #         "current_status": {
    #             "status": "new",
    #             "date": {
    #                 "date": "20210816",
    #                 "time": "18:57:15"
    #             }
    #         },
    #         "status_history": [
    #             {
    #                 "status": "new",
    #                 "date": {
    #                     "date": "20210816",
    #                     "time": "18:57:15"
    #                 }
    #             }
    #         ]
    #     },
    #     "ISA-1": {
    #         "01": "00",
    #         "02": "          ",
    #         "03": "00",
    #         "04": "          ",
    #         "05": "ZZ",
    #         "06": "00009324       ",
    #         "07": "33",
    #         "08": "53589          ",
    #         "09": "210718",
    #         "10": "2222",
    #         "11": "^",
    #         "12": "00501",
    #         "13": "680468897",
    #         "14": "1",
    #         "15": "P",
    #         "16": ":"
    #     },
    #     "GS-2": {
    #         "01": "HR",
    #         "02": "00009324",
    #         "03": "53589",
    #         "04": "20210718",
    #         "05": "2222",
    #         "06": "186887931",
    #         "07": "X",
    #         "08": "005010X212"
    #     },
    #     "ST-3": {
    #         "01": "276",
    #         "02": "825054388",
    #         "03": "005010X212",
    #         "status": "pending",
    #         "BHT-4": {
    #             "01": "0010",
    #             "02": "13",
    #             "03": "533933515",
    #             "04": "20210718",
    #             "05": "2222"
    #         },
    #         "2000A": {
    #             "HL-5": {
    #                 "01": "1",
    #                 "02": "",
    #                 "03": "20",
    #                 "04": "1"
    #             },
    #             "2100A": {
    #                 "NM1-6": {
    #                     "01": "PR",
    #                     "02": "2",
    #                     "03": "BCBS Arizona",
    #                     "04": "",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "PI",
    #                     "09": "53589"
    #                 }
    #             }
    #         },
    #         "2000B": {
    #             "HL-7": {
    #                 "01": "2",
    #                 "02": "1",
    #                 "03": "21",
    #                 "04": "1"
    #             },
    #             "2100B": {
    #                 "NM1-8": {
    #                     "01": "41",
    #                     "02": "2",
    #                     "03": "Medvertex",
    #                     "04": "",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "46",
    #                     "09": "00009324"
    #                 }
    #             }
    #         },
    #         "2000C": {
    #             "HL-9": {
    #                 "01": "3",
    #                 "02": "2",
    #                 "03": "19",
    #                 "04": "1"
    #             },
    #             "2100C": {
    #                 "NM1-10": {
    #                     "01": "1P",
    #                     "02": "1",
    #                     "03": "AHMED",
    #                     "04": "AFROZA",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "XX",
    #                     "09": "1104284595"
    #                 }
    #             }
    #         },
    #         "2000D": {
    #             "HL-11": {
    #                 "01": "4",
    #                 "02": "3",
    #                 "03": "22",
    #                 "04": "0"
    #             },
    #             "DMG-12": {
    #                 "01": "D8",
    #                 "02": "19951006",
    #                 "03": "F"
    #             },
    #             "2100D": {
    #                 "NM1-14": {
    #                     "01": "IL",
    #                     "02": "1",
    #                     "03": "Alonso",
    #                     "04": "Mirtha",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "MI",
    #                     "09": "QQV410W00455"
    #                 },
    #                 "2200D": {
    #                     "TRN-15": {
    #                         "01": "1",
    #                         "02": "825054388"
    #                     },
    #                     "REF-16": {
    #                         "01": "EJ",
    #                         "02": "11111"
    #                     },
    #                     "AMT-17": {
    #                         "01": "T3",
    #                         "02": "185"
    #                     },
    #                     "DTP-18": {
    #                         "01": "472",
    #                         "02": "D8",
    #                         "03": "20190803"
    #                     }
    #                 }
    #             }
    #         },
    #         "SE-20": {
    #             "01": "16",
    #             "02": "825054388"
    #         }
    #     },
    #     "ST-21": {
    #         "01": "276",
    #         "02": "825054388",
    #         "03": "005010X212",
    #         "status": "pending",
    #         "BHT-22": {
    #             "01": "0010",
    #             "02": "13",
    #             "03": "247743749",
    #             "04": "20210718",
    #             "05": "2222"
    #         },
    #         "2000A": {
    #             "HL-23": {
    #                 "01": "1",
    #                 "02": "",
    #                 "03": "20",
    #                 "04": "1"
    #             },
    #             "2100A": {
    #                 "NM1-24": {
    #                     "01": "PR",
    #                     "02": "2",
    #                     "03": "BCBS Arizona",
    #                     "04": "",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "PI",
    #                     "09": "53589"
    #                 }
    #             }
    #         },
    #         "2000B": {
    #             "HL-25": {
    #                 "01": "2",
    #                 "02": "1",
    #                 "03": "21",
    #                 "04": "1"
    #             },
    #             "2100B": {
    #                 "NM1-26": {
    #                     "01": "41",
    #                     "02": "2",
    #                     "03": "Medvertex",
    #                     "04": "",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "46",
    #                     "09": "00009324"
    #                 }
    #             }
    #         },
    #         "2000C": {
    #             "HL-27": {
    #                 "01": "3",
    #                 "02": "2",
    #                 "03": "19",
    #                 "04": "1"
    #             },
    #             "2100C": {
    #                 "NM1-28": {
    #                     "01": "1P",
    #                     "02": "1",
    #                     "03": "AHMED",
    #                     "04": "AFROZA",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "XX",
    #                     "09": "1104284595"
    #                 }
    #             }
    #         },
    #         "2000D": {
    #             "HL-29": {
    #                 "01": "4",
    #                 "02": "3",
    #                 "03": "22",
    #                 "04": "0"
    #             },
    #             "DMG-30": {
    #                 "01": "D8",
    #                 "02": "19951006",
    #                 "03": "F"
    #             },
    #             "2100D": {
    #                 "NM1-32": {
    #                     "01": "IL",
    #                     "02": "1",
    #                     "03": "Alonso",
    #                     "04": "Mirtha",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "MI",
    #                     "09": "QQV410W00455"
    #                 },
    #                 "2200D": {
    #                     "TRN-33": {
    #                         "01": "1",
    #                         "02": "825054388"
    #                     },
    #                     "REF-34": {
    #                         "01": "EJ",
    #                         "02": "11111"
    #                     },
    #                     "AMT-35": {
    #                         "01": "T3",
    #                         "02": "200"
    #                     },
    #                     "DTP-36": {
    #                         "01": "472",
    #                         "02": "D8",
    #                         "03": "20210628"
    #                     }
    #                 }
    #             }
    #         },
    #         "SE-38": {
    #             "01": "16",
    #             "02": "825054388"
    #         }
    #     },
    #     "ST-39": {
    #         "01": "276",
    #         "02": "825054388",
    #         "03": "005010X212",
    #         "status": "pending",
    #         "BHT-40": {
    #             "01": "0010",
    #             "02": "13",
    #             "03": "177401807",
    #             "04": "20210718",
    #             "05": "2222"
    #         },
    #         "2000A": {
    #             "HL-41": {
    #                 "01": "1",
    #                 "02": "",
    #                 "03": "20",
    #                 "04": "1"
    #             },
    #             "2100A": {
    #                 "NM1-42": {
    #                     "01": "PR",
    #                     "02": "2",
    #                     "03": "BCBS Arizona",
    #                     "04": "",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "PI",
    #                     "09": "53589"
    #                 }
    #             }
    #         },
    #         "2000B": {
    #             "HL-43": {
    #                 "01": "2",
    #                 "02": "1",
    #                 "03": "21",
    #                 "04": "1"
    #             },
    #             "2100B": {
    #                 "NM1-44": {
    #                     "01": "41",
    #                     "02": "2",
    #                     "03": "Medvertex",
    #                     "04": "",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "46",
    #                     "09": "00009324"
    #                 }
    #             }
    #         },
    #         "2000C": {
    #             "HL-45": {
    #                 "01": "3",
    #                 "02": "2",
    #                 "03": "19",
    #                 "04": "1"
    #             },
    #             "2100C": {
    #                 "NM1-46": {
    #                     "01": "1P",
    #                     "02": "1",
    #                     "03": "AHMED",
    #                     "04": "AFROZA",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "XX",
    #                     "09": "1104284595"
    #                 }
    #             }
    #         },
    #         "2000D": {
    #             "HL-47": {
    #                 "01": "4",
    #                 "02": "3",
    #                 "03": "22",
    #                 "04": "0"
    #             },
    #             "DMG-48": {
    #                 "01": "D8",
    #                 "02": "19951006",
    #                 "03": "F"
    #             },
    #             "2100D": {
    #                 "NM1-50": {
    #                     "01": "IL",
    #                     "02": "1",
    #                     "03": "Alonso",
    #                     "04": "Mirtha",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "MI",
    #                     "09": "QQV410W00455"
    #                 },
    #                 "2200D": {
    #                     "TRN-51": {
    #                         "01": "1",
    #                         "02": "825054388"
    #                     },
    #                     "REF-52": {
    #                         "01": "EJ",
    #                         "02": "11111"
    #                     },
    #                     "AMT-53": {
    #                         "01": "T3",
    #                         "02": "200"
    #                     },
    #                     "DTP-54": {
    #                         "01": "472",
    #                         "02": "D8",
    #                         "03": "20210628"
    #                     }
    #                 }
    #             }
    #         },
    #         "SE-56": {
    #             "01": "16",
    #             "02": "825054388"
    #         }
    #     },
    #     "ST-57": {
    #         "01": "276",
    #         "02": "825054388",
    #         "03": "005010X212",
    #         "status": "pending",
    #         "BHT-58": {
    #             "01": "0010",
    #             "02": "13",
    #             "03": "450339263",
    #             "04": "20210718",
    #             "05": "2222"
    #         },
    #         "2000A": {
    #             "HL-59": {
    #                 "01": "1",
    #                 "02": "",
    #                 "03": "20",
    #                 "04": "1"
    #             },
    #             "2100A": {
    #                 "NM1-60": {
    #                     "01": "PR",
    #                     "02": "2",
    #                     "03": "BCBS Arizona",
    #                     "04": "",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "PI",
    #                     "09": "53589"
    #                 }
    #             }
    #         },
    #         "2000B": {
    #             "HL-61": {
    #                 "01": "2",
    #                 "02": "1",
    #                 "03": "21",
    #                 "04": "1"
    #             },
    #             "2100B": {
    #                 "NM1-62": {
    #                     "01": "41",
    #                     "02": "2",
    #                     "03": "Medvertex",
    #                     "04": "",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "46",
    #                     "09": "00009324"
    #                 }
    #             }
    #         },
    #         "2000C": {
    #             "HL-63": {
    #                 "01": "3",
    #                 "02": "2",
    #                 "03": "19",
    #                 "04": "1"
    #             },
    #             "2100C": {
    #                 "NM1-64": {
    #                     "01": "1P",
    #                     "02": "1",
    #                     "03": "AHMED",
    #                     "04": "AFROZA",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "XX",
    #                     "09": "1104284595"
    #                 }
    #             }
    #         },
    #         "2000D": {
    #             "HL-65": {
    #                 "01": "4",
    #                 "02": "3",
    #                 "03": "22",
    #                 "04": "0"
    #             },
    #             "DMG-66": {
    #                 "01": "D8",
    #                 "02": "19951006",
    #                 "03": "F"
    #             },
    #             "2100D": {
    #                 "NM1-68": {
    #                     "01": "IL",
    #                     "02": "1",
    #                     "03": "Alonso",
    #                     "04": "Mirtha",
    #                     "05": "",
    #                     "06": "",
    #                     "07": "",
    #                     "08": "MI",
    #                     "09": "QQV410W00455"
    #                 },
    #                 "2200D": {
    #                     "TRN-69": {
    #                         "01": "1",
    #                         "02": "825054388"
    #                     },
    #                     "REF-70": {
    #                         "01": "EJ",
    #                         "02": "11111"
    #                     },
    #                     "AMT-71": {
    #                         "01": "T3",
    #                         "02": "200"
    #                     },
    #                     "DTP-72": {
    #                         "01": "472",
    #                         "02": "D8",
    #                         "03": "20210628"
    #                     }
    #                 }
    #             }
    #         },
    #         "SE-74": {
    #             "01": "16",
    #             "02": "825054388"
    #         }
    #     },
    #     "GE-75": {
    #         "01": "4",
    #         "02": "186887931"
    #     },
    #     "IEA-76": {
    #         "01": "0",
    #         "02": "680468897"
    #     }
    # }
    #
    # data_provider_276 = DataProvider276(edi_276)
    # for segment in edi_276:
    #     if segment.split('-')[0] == 'ST':
    #         data_provider_276.bulid_body_data_provider(edi_276.get(segment))
    #
    #         print(data_provider_276.st_data_provider.get_loop2100a_nm101())

    consumer = Consumer("")
    if consumer.check_credentials_code():
        process_999 = Process_999()
        # print(json_util.dumps(process_999.get_edi_file(), indent=4))
        # print(json_util.dumps(process_999.get_ack_dict(), indent=4))
        consumer.check_ack_file(process_999.get_edi_file(), process_999.get_ack_dict())
        # connection = ConnectMongoDB()
        # connection.connect_to_ack_collection()
        # ack_277ca_dict = connection.get_277ca_dict()
        # test_277ca_consumer = Consumer277CA()
        # test_277ca_consumer.check_ack_file(ack_277ca_dict)
    else:
        print("You Are Not Allowed to Access Data")
